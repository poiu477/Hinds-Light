generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SourceType {
  RSS
  X
  TELEGRAM
  YOUTUBE
  WEBSITE
}

enum ContentType {
  ARTICLE
  POST
  TWEET
  THREAD
  VIDEO
}

enum TranslationStatus {
  PENDING
  TRANSLATED
  FAILED
}

model Source {
  id        String       @id @default(cuid())
  type      SourceType
  name      String
  url       String?
  displayName String?
  alignment   String?
  language  String       @default("he")
  active    Boolean      @default(true)
  items     ContentItem[]
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@index([type, active])
}

model ContentItem {
  id                 String            @id @default(cuid())
  sourceId           String
  source             Source            @relation(fields: [sourceId], references: [id], onDelete: Cascade)
  type               ContentType
  title              String?
  url                String?           @unique
  contentHash        String?           @unique
  originalLanguage   String            @default("he")
  originalText       String
  translatedLanguage String?
  translatedText     String?
  translationStatus  TranslationStatus @default(PENDING)
  translationConfidence Float?
  publishedAt        DateTime?
  rawJson            Json?
  // Moderation & meta
  verified           Boolean           @default(false)
  flagged            Boolean           @default(false)
  flagReason         String?
  flagNote           String?
  flaggedAt          DateTime?
  sentiment          String?
  tags               String[]          @default([])
  keywords           String[]          @default([])
  // Author (mostly for social; null for RSS)
  authorUsername       String?
  authorDisplayName    String?
  authorVerified       Boolean          @default(false)
  authorFollowerCount  Int?
  // Metrics
  metricsLikes   Int   @default(0)
  metricsShares  Int   @default(0)
  metricsReplies Int   @default(0)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  @@index([sourceId, publishedAt])
  @@index([translationStatus])
  @@index([publishedAt])
  @@index([sentiment])
}






